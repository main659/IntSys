---
title: "Assignment2"
author: "David Ocepek, Matevz Erzen"
date: "1/1/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tm)
library(wordcloud)
library(ggplot2)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cleanning}
train = read.table(file = "C:\\Users\\david\\OneDrive\\Dokumente\\GitHub\\IntelligentSystems\\insults\\train.tsv",
                   sep = '\t', 
                   header = TRUE,
                   stringsAsFactors=FALSE 
                   )
test = read.table(file = "C:\\Users\\david\\OneDrive\\Dokumente\\GitHub\\IntelligentSystems\\insults\\test.tsv",
                  sep = '\t', 
                  header = TRUE,
                  stringsAsFactors=FALSE 
                  )

handle_special_char <- function(doc)
{
  doc = gsub("\\\\x[0-9a-fA-F]{2}", " ", doc) #UTF-8 characters
  doc = gsub("\\x[0-9a-fA-F]{2}", " ", doc) #UTF-8 characters
  doc = gsub("\\[0-9a-fA-F]", " ", doc) #non-alfanumeric chars
  doc = iconv(doc, "latin1", "ASCII", sub="")
  
  return(doc)
}

conn = file("english.stop.txt", open="r")
mystopwords = readLines(conn)
close(conn)

y = train[,1]
X = train[,2]
X <- handle_special_char(X) #Remove special utf8 characters
X <- Corpus(VectorSource(X))
#TO-DO: Remove proper nouns
X <- tm_map(X, content_transformer(tolower)) #Transform to lower
X <- tm_map(X, removePunctuation) #Remove punctuations
X <- tm_map(X, removeNumbers) #Remove number
X <- tm_map(X, removeWords, stopwords("english")) #Remove stopwords
X <- tm_map(X, removeWords, mystopwords) #Remove custom stopwords
X <- tm_map(X, stemDocument) #Get radicals
X <- tm_map(X, stripWhitespace) #Have only one white space
```

```{r frequency analisys}
tdm <- TermDocumentMatrix(X)
termFrequency <- rowSums(as.matrix(tdm))
qplot(seq(length(termFrequency)),sort(termFrequency), xlab = "index", ylab = "Freq")
findFreqTerms(tdm, lowfreq=100)
termFrequency <- subset(termFrequency, termFrequency >= 100)
qplot(seq(length(termFrequency)),sort(termFrequency), xlab = "index", ylab = "Freq")
```

```{r vector exploration}
dtm <- DocumentTermMatrix(X, control = list(minDocFreq=2, minWordLength=3, normalize = TRUE, weighting=weightTfIdf))
rowTotals <- slam::row_sums(dtm)
dtm <- dtm[rowTotals > 0, ]
mat <- as.matrix(dtm)

pca <- prcomp(mat, scale. = TRUE, rank. = 2)
comp1 <- as.numeric(pca$x[,1])
comp2 <- as.numeric(pca$x[,2])
#TO-DO: Fix kmeans

kmeansResult <- kmeans(mat, 2)
qplot(comp1, comp2, color=kmeansResult$cluster)
kmeansResult <- kmeans(mat, 4)
qplot(comp1, comp2, color=kmeansResult$cluster)
kmeansResult <- kmeans(mat, 8)
qplot(comp1, comp2, color=kmeansResult$cluster)
kmeansResult <- kmeans(mat, 16)
qplot(comp1, comp2, color=kmeansResult$cluster)
qplot(comp1, comp2, color=y[rowTotals > 0])

#TO-DO: POS
```